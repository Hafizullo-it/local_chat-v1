<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Modern Chat</title>
    <link href="/libs/tailwind.min.css?v=5.0" rel="stylesheet">
    <link href="/libs/fontawesome.min.css?v=5.0" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f172a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: #3b82f6;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .chat-main {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-size: cover;
            background-position: center;
        }

        .right-panel.active {
            display: flex;
        }

        .message-info .fa-check {
            color: #ccc;
        }

        .message-info .fa-check-double {
            color: #3b82f6;
        }

        .user-item button {
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }

        .user-item:hover button {
            opacity: 1;
        }

        #emoji-picker.hidden {
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes dot-pulse {

            0%,
            100% {
                transform: translateY(0);
                opacity: 0.8;
            }

            50% {
                transform: translateY(-3px);
                opacity: 1;
            }
        }

        .dot-pulse {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .dot-pulse::before,
        .dot-pulse::after,
        .dot-pulse div {
            content: '';
            width: 6px;
            height: 6px;
            background-color: #9ca3af;
            border-radius: 50%;
            animation: dot-pulse 1s infinite ease-in-out;
        }

        .dot-pulse::before {
            animation-delay: 0s;
        }

        .dot-pulse div {
            animation-delay: 0.2s;
        }

        .dot-pulse::after {
            animation-delay: 0.4s;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-900 to-gray-900 text-gray-100 h-screen flex overflow-hidden">

    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loader"></div>
        <div class="mt-4 text-white font-semibold">–ó–∞–≥—Ä—É–∑–∫–∞ Modern Chat...</div>
    </div>

    <!-- Chat Layout Wrapper -->
    <div id="chat-layout" class="hidden flex w-full h-full overflow-hidden relative">
        <!-- Sidebar -->
        <div id="sidebar"
            class="w-96 min-w-[24rem] bg-gray-800 bg-opacity-50 backdrop-filter backdrop-blur-lg border-r border-gray-700 flex flex-col transition-all duration-300 transform -translate-x-full md:translate-x-0 absolute md:relative z-20 h-full flex-shrink-0">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-800 bg-opacity-50">
                <div class="flex items-center gap-3">
                    <img id="my-ava"
                        class="w-10 h-10 rounded-full object-cover border-2 border-green-500 cursor-pointer hover:opacity-80 transition-opacity"
                        onclick="openProfileSettings()">
                    <div>
                        <h4 id="my-name" class="font-bold text-white text-lg tracking-wide">User</h4>
                        <span class="text-xs text-green-400 flex items-center gap-1"><i
                                class="fas fa-circle text-[8px]"></i> –û–Ω–ª–∞–π–Ω</span>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button id="admin-panel-btn"
                        class="text-gray-400 hover:text-purple-400 p-2 rounded-full hover:bg-gray-700 transition-all duration-200 hidden"
                        onclick="window.location.href='/admin-access?userId=' + user.id" title="–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å">
                        <i class="fas fa-shield-alt"></i>
                    </button>
                    <button
                        class="text-gray-400 hover:text-red-400 p-2 rounded-full hover:bg-gray-700 transition-all duration-200"
                        onclick="logout()" title="–í—ã–π—Ç–∏">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            <div class="p-4">
                <div class="relative group">
                    <span
                        class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400 group-focus-within:text-blue-500 transition-colors"><i
                            class="fas fa-search"></i></span>
                    <input type="text" id="user-search" placeholder="–ü–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤..."
                        class="w-full bg-gray-900 border border-gray-700 rounded-xl py-2 pl-10 pr-4 text-gray-300 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all text-sm">
                </div>
            </div>
            <div class="p-2 overflow-y-auto flex-grow custom-scrollbar">
                <div class="p-3 cursor-pointer flex items-center gap-3 rounded-lg mx-2 my-1 relative transition-colors duration-200 hover:bg-gray-700"
                    id="btn-global" onclick="openGlobal()">
                    <span class="text-2xl">üåç</span>
                    <div class="flex-grow"><b class="font-semibold text-white">–û–±—â–∏–π —á–∞—Ç</b></div>
                </div>
                <div id="user-list"></div>
            </div>
            <div class="p-4 border-t border-gray-700 flex flex-col gap-2">
                <a href="#" class="text-blue-400 hover:text-blue-300 flex items-center gap-2 transition-colors"
                    onclick="openProfileSettings()">
                    <i class="fas fa-cog text-lg"></i><span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</span>
                </a>
                <a href="#" class="text-purple-400 hover:text-purple-300 flex items-center gap-2 transition-colors"
                    onclick="openGamesHub()">
                    <i class="fas fa-gamepad text-lg"></i><span>–ò–≥—Ä–æ–≤–æ–π –•–æ–ª–ª</span>
                </a>
            </div>
        </div>

        <!-- Chat Screen -->
        <div id="chat-screen"
            class="flex-grow bg-gray-900 flex flex-col relative w-full h-full min-w-0 overflow-hidden">
            <div
                class="px-6 py-4 bg-gray-800 bg-opacity-90 backdrop-filter backdrop-blur-lg border-b border-gray-700 flex justify-between items-center z-10 shadow-sm flex-none h-[73px]">
                <div class="flex items-center gap-3">
                    <button class="md:hidden text-gray-400 hover:text-white"
                        onclick="document.getElementById('sidebar').classList.toggle('-translate-x-full')"><i
                            class="fas fa-bars text-xl"></i></button>
                    <img id="chat-avatar" class="w-10 h-10 rounded-full object-cover hidden">
                    <b id="chat-with" class="lg:text-lg font-semibold text-white text-base">///</b>
                </div>
                <button
                    class="text-gray-400 hover:text-blue-400 transition-colors duration-200 p-2 rounded-full hover:bg-gray-700"
                    onclick="toggleRightPanel()" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ"><i
                        class="fas fa-info-circle text-xl"></i></button>
            </div>
            <div id="pinned-message"
                class="bg-blue-800 bg-opacity-30 p-3 text-sm text-blue-100 flex items-start gap-3 hidden border-b border-blue-700">
                <i class="fas fa-thumbtack text-blue-300 mt-0.5"></i>
                <span class="flex-grow">üìú –ü–†–ê–í–ò–õ–ê: Spam/Flood ‚Äî –±–∞–Ω. Profanity ‚Äî –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã. Fake Identities ‚Äî
                    –∑–∞–ø—Ä–µ—â–µ–Ω–æ.</span>
            </div>
            <div id="messages" class="flex-grow overflow-y-auto p-4 flex flex-col gap-3 overscroll-contain"></div>
            <div id="typing-indicator"
                class="text-sm text-gray-400 px-4 py-2 italic transition-opacity duration-300 flex items-center gap-2 hidden">
                <div class="dot-pulse">
                    <div></div>
                    <div></div>
                    <div></div>
                </div><span>–ü–µ—á–∞—Ç–∞–µ—Ç...</span>
            </div>
            <div id="mention-autocomplete"
                class="absolute bottom-20 left-4 bg-gray-800 border border-gray-700 rounded-lg p-2 z-50 shadow-2xl hidden">
            </div>
            <div id="reply-preview"
                class="bg-gray-700 bg-opacity-70 border-l-4 border-blue-400 p-2 rounded-lg text-xs mb-1 flex items-center justify-between hidden mx-4">
                <div class="flex-grow">
                    <div id="reply-original-sender" class="font-bold text-blue-300"></div>
                    <div id="reply-original-content" class="text-gray-200 truncate"></div>
                </div>
                <button
                    class="text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-600 transition-colors duration-200"
                    onclick="cancelReply()"><i class="fas fa-times text-lg"></i></button>
            </div>
            <div id="emoji-picker"
                class="absolute bottom-20 left-4 bg-gray-800 border border-gray-700 rounded-lg p-2 z-50 shadow-2xl grid grid-cols-6 gap-1 hidden">
            </div>
            <div
                class="px-4 py-4 bg-gray-800 bg-opacity-90 backdrop-filter backdrop-blur-lg border-t border-gray-700 flex-none z-20">
                <div class="flex items-end gap-2 bg-gray-700 bg-opacity-50 rounded-2xl p-2 border border-gray-600">
                    <button
                        class="p-2 rounded-full text-gray-400 hover:text-yellow-400 hover:bg-gray-600 transition-colors duration-200 mb-1"
                        onclick="toggleEmoji(event)"><i class="fas fa-smile text-xl"></i></button>
                    <div class="relative mb-1">
                        <button
                            class="p-2 rounded-full text-gray-400 hover:text-green-400 hover:bg-gray-600 transition-colors duration-200"
                            onclick="document.getElementById('file-upload').click()"><i
                                class="fas fa-paperclip text-xl"></i></button>
                        <input type="file" id="file-upload" class="hidden" onchange="uploadFile(this)">
                    </div>
                    <textarea id="msgInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                        class="w-full bg-transparent text-white placeholder-gray-400 focus:outline-none resize-none custom-scrollbar py-2"
                        style="min-height: 80px; max-height: 300px;"></textarea>
                    <button
                        class="p-3 rounded-full bg-blue-600 hover:bg-blue-700 text-white transition-all transform hover:scale-105 mb-1"
                        onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div id="right-panel"
            class="w-0 bg-gray-800 bg-opacity-95 backdrop-filter backdrop-blur-xl border-l border-gray-700 flex-col p-0 transition-all duration-300 ease-in-out overflow-hidden flex-shrink-0 flex">
            <div class="p-4 flex flex-col h-full min-w-[18rem]">
                <div class="flex justify-between items-center mb-4 pb-2 border-b border-gray-700">
                    <h5 class="text-xl font-semibold text-white">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ</h5>
                    <button class="text-gray-400 hover:text-blue-400 p-1 rounded-full hover:bg-gray-700"
                        onclick="toggleRightPanel()"><i class="fas fa-times text-xl"></i></button>
                </div>
                <div class="mb-6">
                    <h6 class="text-gray-300 font-semibold mb-2">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ–Ω–ª–∞–π–Ω (<span id="members-count"
                            class="text-blue-400">0</span>)</h6>
                    <div id="members-list" class="overflow-y-auto max-h-48 custom-scrollbar pr-2"></div>
                </div>
                <div class="mt-auto pt-4 border-t border-gray-700 text-sm text-gray-400">
                    <p>–í–µ—Ä—Å–∏—è —á–∞—Ç–∞: 5.0</p>
                    <p>&copy; by No Name</p>
                </div>
            </div>
        </div>
    </div> <!-- End Chat Layout -->

    <!-- Login Screen -->
    <div id="login-screen"
        class="h-screen w-full bg-gray-900 flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 z-0">
            <div
                class="absolute top-0 -left-4 w-72 h-72 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob">
            </div>
            <div
                class="absolute top-0 -right-4 w-72 h-72 bg-blue-500 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob animation-delay-2000">
            </div>
            <div
                class="absolute -bottom-8 left-20 w-72 h-72 bg-pink-500 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob animation-delay-4000">
            </div>
        </div>
        <div
            class="bg-gray-800 bg-opacity-60 backdrop-filter backdrop-blur-xl p-8 rounded-2xl shadow-2xl w-full max-w-md border border-gray-700 relative z-10 mx-4">
            <div class="text-center mb-6">
                <h1
                    class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 mb-2">
                    Modern Chat</h1>
                <p class="text-gray-400">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</p>
            </div>
            <div class="flex justify-center mb-6 bg-gray-700 p-1 rounded-lg">
                <button id="tab-login"
                    class="w-1/2 py-2 rounded-md font-semibold text-white bg-blue-600 shadow-md transition-all"
                    onclick="switchAuthTab('login')">–í—Ö–æ–¥</button>
                <button id="tab-register"
                    class="w-1/2 py-2 rounded-md font-semibold text-gray-400 hover:text-white transition-all"
                    onclick="switchAuthTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label for="auth-username" class="block text-gray-300 text-sm font-semibold mb-2">–ò–º—è
                        –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"><i
                                class="fas fa-user"></i></span>
                        <input type="text" id="auth-username"
                            class="w-full bg-gray-700 border border-gray-600 rounded-lg py-3 pl-10 pr-3 text-white focus:outline-none focus:border-blue-500 transition-colors focus:ring-1 focus:ring-blue-500"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                    </div>
                </div>
                <div>
                    <label for="auth-password" class="block text-gray-300 text-sm font-semibold mb-2">–ü–∞—Ä–æ–ª—å</label>
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400"><i
                                class="fas fa-lock"></i></span>
                        <input type="password" id="auth-password"
                            class="w-full bg-gray-700 border border-gray-600 rounded-lg py-3 pl-10 pr-3 text-white focus:outline-none focus:border-blue-500 transition-colors focus:ring-1 focus:ring-blue-500"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                </div>
                <button onclick="handleAuth()" id="auth-submit-btn"
                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3.5 px-4 rounded-lg transform transition-all hover:scale-[1.02] shadow-lg mt-6">–í–æ–π—Ç–∏
                    –≤ —á–∞—Ç</button>
                <p id="auth-error"
                    class="text-red-400 bg-red-900 bg-opacity-30 border border-red-800 rounded p-2 text-sm text-center hidden mt-4 animate-pulse">
                </p>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="profile-settings-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl w-full max-w-md border border-gray-700">
            <h3 class="text-2xl font-bold mb-5 text-white">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h3>
            <div class="space-y-4">
                <input type="text" id="profile-username"
                    class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white" placeholder="–ù–æ–≤–æ–µ –∏–º—è">
                <input type="password" id="profile-old-password"
                    class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white"
                    placeholder="–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å">
                <input type="password" id="profile-new-password"
                    class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white"
                    placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                <input type="file" id="profile-avatar"
                    class="w-full text-white bg-gray-700 rounded-lg p-2 border border-gray-600">
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button class="bg-gray-600 px-4 py-2 rounded-lg" onclick="closeProfileSettings()">–û—Ç–º–µ–Ω–∞</button>
                <button class="bg-blue-600 px-4 py-2 rounded-lg" onclick="saveProfileSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="edit-message-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl w-full max-w-md border border-gray-700">
            <h3 class="text-2xl font-bold mb-5 text-white">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
            <textarea id="edit-msg-input" class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white"
                rows="4"></textarea>
            <div class="flex justify-end gap-3 mt-6">
                <button class="bg-gray-600 px-4 py-2 rounded-lg" onclick="closeEditMessageModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="bg-blue-600 px-4 py-2 rounded-lg" onclick="saveEditedMessage()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="edit-user-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl w-full max-w-md border border-gray-700">
            <h3 class="text-2xl font-bold mb-5 text-white">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <div class="space-y-4">
                <input type="text" id="edit-user-username"
                    class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white" placeholder="–ò–º—è">
                <input type="file" id="edit-user-avatar"
                    class="w-full text-white bg-gray-700 rounded-lg p-2 border border-gray-600">
                <select id="edit-user-role" class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white">
                    <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                    <option value="admin">–ê–¥–º–∏–Ω</option>
                </select>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button class="bg-gray-600 px-4 py-2 rounded-lg" onclick="closeEditUserModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="bg-blue-600 px-4 py-2 rounded-lg" onclick="saveEditedUser()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="games-hub-modal"
        class="fixed inset-0 bg-gray-900 bg-opacity-80 backdrop-blur-md flex items-center justify-center hidden"
        style="z-index: 9999;">
        <div
            class="bg-gray-800 border border-gray-700 p-8 rounded-3xl shadow-2xl w-full max-w-4xl mx-4 relative overflow-hidden">
            <div class="relative z-10">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-extrabold text-white tracking-tight flex items-center gap-3"><i
                            class="fas fa-gamepad text-purple-400"></i> –ò–≥—Ä–æ–≤–æ–π –•–æ–ª–ª</h2>
                    <button onclick="closeGamesHub()" class="text-gray-400 hover:text-white"><i
                            class="fas fa-times text-2xl"></i></button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-700 bg-opacity-40 border border-gray-600 rounded-2xl p-6 hover:bg-gray-700 cursor-pointer"
                        onclick="launchGame('snake')">
                        <div class="flex items-center gap-4 mb-4">
                            <div
                                class="w-14 h-14 bg-green-500 bg-opacity-20 rounded-xl flex items-center justify-center text-3xl">
                                üêç</div>
                            <h3 class="text-xl font-bold text-white">–ë–∏—Ç–≤–∞ –ó–º–µ–µ–∫</h3>
                        </div>
                        <p class="text-gray-400 text-sm mb-4">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –º—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–Ω–∞—è –∑–º–µ–π–∫–∞!</p>
                    </div>
                    <div class="bg-gray-700 bg-opacity-40 border border-gray-600 rounded-2xl p-6 hover:bg-gray-700 cursor-pointer"
                        onclick="launchGame('seabattle')">
                        <div class="flex items-center gap-4 mb-4">
                            <div
                                class="w-14 h-14 bg-blue-500 bg-opacity-20 rounded-xl flex items-center justify-center text-3xl">
                                ‚öì</div>
                            <h3 class="text-xl font-bold text-white">–ú–æ—Ä—Å–∫–æ–π –ë–æ–π</h3>
                        </div>
                        <p class="text-gray-400 text-sm mb-4">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–µ —Å—Ä–∞–∂–µ–Ω–∏–µ —Ñ–ª–æ—Ç–æ–≤ 1 –Ω–∞ 1.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menus -->
    <div id="context-menu"
        class="fixed hidden bg-gray-800 p-2 rounded-lg shadow-xl z-50 flex flex-col border border-gray-700">
        <button id="ctx-reply" class="flex items-center gap-2 p-2 text-sm text-gray-200 hover:bg-gray-700 rounded-md"
            onclick="handleReply()"><i class="fas fa-reply text-blue-400"></i><span>–û—Ç–≤–µ—Ç–∏—Ç—å</span></button>
        <button id="ctx-edit" class="flex items-center gap-2 p-2 text-sm text-gray-200 hover:bg-gray-700 rounded-md"
            onclick="handleEdit()"><i class="fas fa-edit text-yellow-400"></i><span>–ò–∑–º–µ–Ω–∏—Ç—å</span></button>
        <button id="ctx-delete" class="flex items-center gap-2 p-2 text-sm text-red-400 hover:bg-gray-700 rounded-md"
            onclick="handleDelete()"><i class="fas fa-trash text-red-500"></i><span>–£–¥–∞–ª–∏—Ç—å</span></button>
    </div>
    <div id="user-context-menu"
        class="fixed hidden bg-gray-800 p-2 rounded-lg shadow-xl z-50 flex flex-col border border-gray-700">
        <button class="flex items-center gap-2 p-2 text-sm text-red-400 hover:bg-gray-700 rounded-md"
            onclick="handleBanFromUserMenu()"><i
                class="fas fa-user-slash text-red-500"></i><span>–ó–∞–±–∞–Ω–∏—Ç—å</span></button>
        <button class="flex items-center gap-2 p-2 text-sm text-yellow-400 hover:bg-gray-700 rounded-md"
            onclick="handleEditUser()"><i
                class="fas fa-user-edit text-yellow-500"></i><span>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</span></button>
    </div>

    <script src="/script.js?v=5.0"></script>
    <script>
        function openGamesHub() { document.getElementById('games-hub-modal').classList.remove('hidden'); }
        function closeGamesHub() { document.getElementById('games-hub-modal').classList.add('hidden'); }
        function launchGame(game) {
            if (!user) { showToast('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error'); return; }
            window.open(`/games/${game}.html`, '_blank');
        }
    </script>
</body>

</html>