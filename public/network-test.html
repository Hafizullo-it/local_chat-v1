<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ - Modern Chat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #10b981; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
        .pending { color: #f59e0b; }
        .result { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .success-bg { background: #d1fae5; border: 1px solid #10b981; }
        .error-bg { background: #fee2e2; border: 1px solid #ef4444; }
    </style>
</head>
<body>
    <h1 style="color: #2563eb; text-align: center;">üåê –¢–µ—Å—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ Modern Chat</h1>

    <div class="test-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É</h2>
        <div id="connection-test" class="pending">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</div>
        <div id="connection-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>2. –ó–∞–≥—Ä—É–∑–∫–∞ CSS —Ñ–∞–π–ª–æ–≤</h2>
        <div id="css-test" class="pending">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</div>
        <div id="css-result" class="result" style="display: none;"></div>
        <div id="css-visual" style="display: none; margin-top: 10px;">
            <div style="background: #3b82f6; color: white; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                –°–∏–Ω–∏–π –±–ª–æ–∫ (Tailwind CSS —Ä–∞–±–æ—Ç–∞–µ—Ç)
            </div>
            <div>
                <i class="fas fa-check" style="color: #10b981; font-size: 24px;"></i>
                <span style="margin-left: 8px;">–ò–∫–æ–Ω–∫–∞ Font Awesome</span>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>3. WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</h2>
        <div id="websocket-test" class="pending">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</div>
        <div id="websocket-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>4. API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</h2>
        <div id="api-test" class="pending">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</div>
        <div id="api-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>üìä –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h2>
        <div id="final-result" style="text-align: center; font-size: 18px; margin-top: 20px;"></div>
    </div>

    <div style="text-align: center; margin-top: 30px;">
        <button onclick="runAllTests()" style="background: #2563eb; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; margin-right: 10px;">
            üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
        </button>
        <a href="/" style="background: #10b981; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block;">
            üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —á–∞—Ç
        </a>
    </div>

    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã -->
    <link href="/libs/tailwind.min.css?v=3.0" rel="stylesheet" onload="cssLoaded()" onerror="cssError()">
    <link href="/libs/fontawesome.min.css?v=3.0" rel="stylesheet" onload="faLoaded()" onerror="faError()">
    <script src="/socket.io/socket.io.js" onload="socketLoaded()" onerror="socketError()"></script>

    <script>
        let tests = {
            connection: false,
            css: false,
            fontawesome: false,
            websocket: false,
            api: false
        };

        let cssLoadedFlag = false;
        let faLoadedFlag = false;
        let socketLoadedFlag = false;

        function updateTest(testName, status, message) {
            const testElement = document.getElementById(testName + '-test');
            const resultElement = document.getElementById(testName + '-result');

            testElement.className = status === 'success' ? 'success' : status === 'error' ? 'error' : 'pending';
            testElement.textContent = status === 'success' ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' :
                                   status === 'error' ? '‚ùå –û—à–∏–±–∫–∞' : '‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...';

            if (message) {
                resultElement.style.display = 'block';
                resultElement.className = 'result ' + (status === 'success' ? 'success-bg' : 'error-bg');
                resultElement.textContent = message;
            }

            tests[testName.replace('-test', '').replace('-', '')] = status === 'success';
            updateFinalResult();
        }

        function cssLoaded() {
            cssLoadedFlag = true;
            checkCSSComplete();
        }

        function cssError() {
            updateTest('css', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Tailwind CSS');
        }

        function faLoaded() {
            faLoadedFlag = true;
            checkCSSComplete();
        }

        function faError() {
            updateTest('css', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Font Awesome');
        }

        function checkCSSComplete() {
            if (cssLoadedFlag && faLoadedFlag) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç–∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç
                const testElement = document.createElement('div');
                testElement.style.position = 'absolute';
                testElement.style.left = '-9999px';
                testElement.className = 'bg-blue-500 text-white p-2';
                document.body.appendChild(testElement);

                const computedStyle = window.getComputedStyle(testElement);
                const hasBackground = computedStyle.backgroundColor !== '';
                const hasPadding = computedStyle.padding !== '';

                document.body.removeChild(testElement);

                if (hasBackground && hasPadding) {
                    updateTest('css', 'success', 'CSS —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                    document.getElementById('css-visual').style.display = 'block';
                } else {
                    updateTest('css', 'error', 'CSS —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –Ω–æ —Å—Ç–∏–ª–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è');
                }
            }
        }

        function socketLoaded() {
            socketLoadedFlag = true;
            updateTest('websocket', 'success', 'Socket.IO –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        }

        function socketError() {
            updateTest('websocket', 'error', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Socket.IO');
        }

        async function testConnection() {
            try {
                const response = await fetch('/');
                if (response.ok) {
                    updateTest('connection', 'success', 'HTTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç');
                } else {
                    updateTest('connection', 'error', `HTTP –æ—à–∏–±–∫–∞: ${response.status}`);
                }
            } catch (error) {
                updateTest('connection', 'error', `–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`);
            }
        }

        async function testAPI() {
            try {
                const response = await fetch('/api/users');
                if (response.ok) {
                    const data = await response.json();
                    updateTest('api', 'success', `API —Ä–∞–±–æ—Ç–∞–µ—Ç (${data.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)`);
                } else {
                    updateTest('api', 'error', `API –æ—à–∏–±–∫–∞: ${response.status}`);
                }
            } catch (error) {
                updateTest('api', 'error', `–û—à–∏–±–∫–∞ API: ${error.message}`);
            }
        }

        function updateFinalResult() {
            const passedTests = Object.values(tests).filter(test => test === true).length;
            const totalTests = Object.keys(tests).length;

            const resultElement = document.getElementById('final-result');
            if (passedTests === totalTests) {
                resultElement.innerHTML = `<span style="color: #10b981; font-weight: bold;">üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã! (${passedTests}/${totalTests})</span><br><small>–°–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</small>`;
            } else {
                resultElement.innerHTML = `<span style="color: #ef4444; font-weight: bold;">‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã (${passedTests}/${totalTests})</span><br><small>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</small>`;
            }
        }

        async function runAllTests() {
            // –°–±—Ä–æ—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            Object.keys(tests).forEach(key => {
                tests[key] = false;
            });

            // –°–∫—Ä—ã–≤–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            document.getElementById('css-visual').style.display = 'none';

            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
            testConnection();
            testAPI();

            // CSS –∏ WebSocket —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ onload/onerror
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>