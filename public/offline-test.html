<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–∞–±–æ—Ç—ã Modern Chat</title>
    <link href="/libs/tailwind.min.css" rel="stylesheet">
    <link href="/libs/fontawesome.min.css" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        .test-passed { color: #10b981; }
        .test-failed { color: #ef4444; }
        .test-pending { color: #f59e0b; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">
                üß™ –¢–µ—Å—Ç –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–∞–±–æ—Ç—ã Modern Chat
            </h1>

            <div class="space-y-6">
                <!-- –¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
                <div class="test-item bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-gray-800">1. –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h3>
                        <span id="test-page-load" class="test-pending">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                    </div>
                    <p class="text-gray-600">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤</p>
                </div>

                <!-- –¢–µ—Å—Ç 2: CSS —Å—Ç–∏–ª–∏ -->
                <div class="test-item bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-gray-800">2. CSS —Å—Ç–∏–ª–∏</h3>
                        <span id="test-css" class="test-pending">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                    </div>
                    <p class="text-gray-600">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ Tailwind CSS –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ</p>
                    <div class="mt-3 p-3 bg-blue-100 rounded text-blue-800 font-medium">
                        –≠—Ç–æ—Ç –±–ª–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω —Å Tailwind CSS
                    </div>
                </div>

                <!-- –¢–µ—Å—Ç 3: Font Awesome –∏–∫–æ–Ω–∫–∏ -->
                <div class="test-item bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-gray-800">3. Font Awesome –∏–∫–æ–Ω–∫–∏</h3>
                        <span id="test-fontawesome" class="test-pending">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                    </div>
                    <p class="text-gray-600">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∏–∫–æ–Ω–∫–∏ Font Awesome –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è</p>
                    <div class="mt-3 flex space-x-4">
                        <i class="fas fa-edit text-yellow-500 text-2xl" title="–ò–∑–º–µ–Ω–∏—Ç—å"></i>
                        <i class="fas fa-trash text-red-500 text-2xl" title="–£–¥–∞–ª–∏—Ç—å"></i>
                        <i class="fas fa-cog text-gray-600 text-2xl" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏"></i>
                        <i class="fas fa-shield-alt text-blue-600 text-2xl" title="–ê–¥–º–∏–Ω"></i>
                    </div>
                </div>

                <!-- –¢–µ—Å—Ç 4: Socket.IO —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ -->
                <div class="test-item bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-gray-800">4. Socket.IO —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</h3>
                        <span id="test-socket" class="test-pending">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                    </div>
                    <p class="text-gray-600">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è</p>
                    <div id="socket-status" class="mt-2 text-sm text-gray-500">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
                </div>

                <!-- –¢–µ—Å—Ç 5: API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å -->
                <div class="test-item bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-gray-800">5. API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã</h3>
                        <span id="test-api" class="test-pending">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                    </div>
                    <p class="text-gray-600">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω—ã—Ö API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤</p>
                    <div id="api-results" class="mt-2 space-y-1 text-sm"></div>
                </div>

                <!-- –¢–µ—Å—Ç 6: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                <div class="test-item bg-gray-50 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-gray-800">6. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ä–µ—Å—É—Ä—Å—ã</h3>
                        <span id="test-images" class="test-pending">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                    </div>
                    <p class="text-gray-600">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∞–≤–∞—Ç–∞—Ä–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</p>
                    <div class="mt-3 flex space-x-4">
                        <img src="/img/default-avatar.png" alt="–ê–≤–∞—Ç–∞—Ä" class="w-12 h-12 rounded-full border-2 border-gray-300" onerror="this.style.display='none'">
                        <div class="text-sm text-gray-500">–ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–Ω–æ - —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω</div>
                    </div>
                </div>
            </div>

            <div class="mt-8 p-6 bg-blue-50 rounded-lg">
                <h3 class="text-xl font-semibold text-blue-800 mb-4">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-600" id="passed-count">0</div>
                        <div class="text-sm text-gray-600">–ü—Ä–æ–π–¥–µ–Ω–æ</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-red-600" id="failed-count">0</div>
                        <div class="text-sm text-gray-600">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-yellow-600" id="pending-count">6</div>
                        <div class="text-sm text-gray-600">–û–∂–∏–¥–∞–µ—Ç</div>
                    </div>
                </div>
            </div>

            <div class="mt-6 text-center">
                <button onclick="runAllTests()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg mr-4">
                    üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
                </button>
                <a href="/" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg">
                    üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —á–∞—Ç
                </a>
            </div>
        </div>
    </div>

    <script>
        let socket;
        let testResults = {
            pageLoad: false,
            css: false,
            fontawesome: false,
            socket: false,
            api: false,
            images: false
        };

        function updateTestStatus(testName, status, message = '') {
            const element = document.getElementById(`test-${testName}`);
            const countElement = status === 'passed' ? document.getElementById('passed-count') :
                               status === 'failed' ? document.getElementById('failed-count') :
                               document.getElementById('pending-count');

            element.className = `test-${status}`;
            element.innerHTML = status === 'passed' ? '‚úÖ –ü—Ä–æ–π–¥–µ–Ω' :
                               status === 'failed' ? '‚ùå –ü—Ä–æ–≤–∞–ª' :
                               '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...';

            if (message) {
                const messageElement = document.createElement('div');
                messageElement.className = 'text-sm mt-1';
                messageElement.textContent = message;
                element.parentNode.appendChild(messageElement);
            }

            if (testResults[testName] !== status) {
                if (status === 'passed') {
                    document.getElementById('passed-count').textContent = parseInt(document.getElementById('passed-count').textContent) + 1;
                    if (testResults[testName] === 'failed') {
                        document.getElementById('failed-count').textContent = parseInt(document.getElementById('failed-count').textContent) - 1;
                    }
                } else if (status === 'failed') {
                    document.getElementById('failed-count').textContent = parseInt(document.getElementById('failed-count').textContent) + 1;
                    if (testResults[testName] === 'passed') {
                        document.getElementById('passed-count').textContent = parseInt(document.getElementById('passed-count').textContent) - 1;
                    }
                }
                document.getElementById('pending-count').textContent = parseInt(document.getElementById('pending-count').textContent) - 1;
                testResults[testName] = status;
            }
        }

        async function testPageLoad() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
                updateTestStatus('pageLoad', 'passed', '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
            } catch (error) {
                updateTestStatus('pageLoad', 'failed', `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`);
            }
        }

        function testCSS() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Tailwind CSS –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
            const testElement = document.querySelector('.bg-blue-100');
            if (testElement && window.getComputedStyle(testElement).backgroundColor !== '') {
                updateTestStatus('css', 'passed', 'Tailwind CSS –∑–∞–≥—Ä—É–∂–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç');
            } else {
                updateTestStatus('css', 'failed', 'Tailwind CSS –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è');
            }
        }

        function testFontAwesome() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Font Awesome –∏–∫–æ–Ω–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
            const icons = document.querySelectorAll('.fa-edit, .fa-trash, .fa-cog, .fa-shield-alt');
            let loaded = 0;
            icons.forEach(icon => {
                if (window.getComputedStyle(icon, '::before').content !== 'none') {
                    loaded++;
                }
            });

            if (loaded >= 3) { // –ú–∏–Ω–∏–º—É–º 3 –∏–∫–æ–Ω–∫–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è
                updateTestStatus('fontawesome', 'passed', `Font Awesome —Ä–∞–±–æ—Ç–∞–µ—Ç (${loaded} –∏–∫–æ–Ω–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–æ)`);
            } else {
                updateTestStatus('fontawesome', 'failed', `Font Awesome –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Ç–æ–ª—å–∫–æ ${loaded} –∏–∫–æ–Ω–æ–∫)`);
            }
        }

        function testSocketConnection() {
            try {
                socket = io();
                const statusElement = document.getElementById('socket-status');

                socket.on('connect', () => {
                    statusElement.textContent = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                    statusElement.className = 'mt-2 text-sm text-green-600';
                    updateTestStatus('socket', 'passed', 'WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                });

                socket.on('connect_error', (error) => {
                    statusElement.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                    statusElement.className = 'mt-2 text-sm text-red-600';
                    updateTestStatus('socket', 'failed', `WebSocket –æ—à–∏–±–∫–∞: ${error.message}`);
                });

                socket.on('disconnect', () => {
                    statusElement.textContent = 'üîå –û—Ç–∫–ª—é—á–µ–Ω–æ';
                    statusElement.className = 'mt-2 text-sm text-yellow-600';
                });

                // –¢–∞–π–º–∞—É—Ç –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                setTimeout(() => {
                    if (!socket.connected) {
                        updateTestStatus('socket', 'failed', '–¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ WebSocket');
                    }
                }, 3000);

            } catch (error) {
                updateTestStatus('socket', 'failed', `–û—à–∏–±–∫–∞ Socket.IO: ${error.message}`);
            }
        }

        async function testAPI() {
            const apiResults = document.getElementById('api-results');
            const endpoints = ['/api/users'];
            let passed = 0;

            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    const result = document.createElement('div');
                    if (response.ok) {
                        result.textContent = `‚úÖ ${endpoint} - –¥–æ—Å—Ç—É–ø–µ–Ω`;
                        result.className = 'text-green-600';
                        passed++;
                    } else {
                        result.textContent = `‚ùå ${endpoint} - –æ—à–∏–±–∫–∞ ${response.status}`;
                        result.className = 'text-red-600';
                    }
                    apiResults.appendChild(result);
                } catch (error) {
                    const result = document.createElement('div');
                    result.textContent = `‚ùå ${endpoint} - ${error.message}`;
                    result.className = 'text-red-600';
                    apiResults.appendChild(result);
                }
            }

            if (passed > 0) {
                updateTestStatus('api', 'passed', `API —Ä–∞–±–æ—Ç–∞–µ—Ç (${passed}/${endpoints.length} —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã)`);
            } else {
                updateTestStatus('api', 'failed', 'API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        }

        function testImages() {
            const img = document.querySelector('img[alt="–ê–≤–∞—Ç–∞—Ä"]');
            if (img && img.complete && img.naturalHeight > 0) {
                updateTestStatus('images', 'passed', '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
            } else {
                updateTestStatus('images', 'failed', '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è');
            }
        }

        function runAllTests() {
            // –°–±—Ä–æ—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            Object.keys(testResults).forEach(key => {
                testResults[key] = false;
            });
            document.getElementById('passed-count').textContent = '0';
            document.getElementById('failed-count').textContent = '0';
            document.getElementById('pending-count').textContent = '6';

            // –û—á–∏—Å—Ç–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
            document.querySelectorAll('.test-item .text-sm').forEach(el => {
                if (!el.textContent.includes('–ü—Ä–æ–≤–µ—Ä—è–µ—Ç')) {
                    el.remove();
                }
            });
            document.getElementById('api-results').innerHTML = '';

            // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
            testPageLoad();
            testCSS();
            testFontAwesome();
            testSocketConnection();
            testAPI();
            testImages();
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 500); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
        });
    </script>
</body>
</html>